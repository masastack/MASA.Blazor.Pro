@inherits LayoutComponentBase
@inject I18n I18n

<MApp>
    <CascadingValue Value="I18n">
        <MAppBar Elevation=0 App Height="100" Class="@($"default-app-bar {(_pageTab == PageModes.PageTab ? "mx-6" : "mx-6 rounded-b-4")}")">
            <div class="d-flex full-width align-center" style="height: 64px">
                <Favorite />
                <MSpacer />
                <Search />
                <MIcon Size=20 Class="ml-5" Color="neutral-lighten-3">mdi-message-processing-outline</MIcon>
                <MIcon Size=20 Class="ml-5" Color="neutral-lighten-3" OnClick="() => _showSetting = true">mdi-cog-outline</MIcon>
                <Language OnLanguageChanged="OnLanguageChanged" />
                <Login />
            </div>
            <div class="full-width">
                @if (_pageTab == PageModes.PageTab)
                {
                    <PageTabs @ref="_pageTabs"/>
                }
                else
                {
                    <Breadcrumb />
                }
            </div>
        </MAppBar>

        <Navigation />

        <MMain Class="fill-lighten-1">
            <div class="pa-6">
                @if (_pageTab == PageModes.PageTab)
                {
                    <PWindow PageTabs="@_pageTabs?.PPageTabs">
                        @Body
                    </PWindow>
                }
                else
                {
                    @Body
                }
            </div>
        </MMain>
        <Settings @bind-PageModel="_pageTab" @bind-Show=_showSetting />
    </CascadingValue>
</MApp>

@code {
    private bool _showSetting;
    private string? _pageTab;

    private PageTabs? _pageTabs;

    void OnLanguageChanged(CultureInfo culture)
    {
        I18n.SetCulture(culture);
    }

}
